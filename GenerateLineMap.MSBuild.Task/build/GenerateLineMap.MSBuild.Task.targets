<?xml version="1.0" encoding="utf-8" ?>
<Project ToolsVersion="4.0" DefaultTargets="Build" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">

  <UsingTask 
    TaskName="GenerateLineMapTask" 
    AssemblyFile="$(MSBuildThisFileDirectory)..\tools\GenerateLineMap.MsBuild.Task.dll" 
  />

  <!-- Inject our task into the build process -->
  <PropertyGroup>
    <BuildDependsOn>
      $(BuildDependsOn);
      GenerateLineMap
    </BuildDependsOn>
  </PropertyGroup>

  <!-- Define our task here -->
  <Target Name="GenerateLineMap" AfterTargets="CopyFilesToOutputDirectory">

    <ItemGroup>
      <CopyLocalReferences Include="@(ReferencePath)" Condition=" '%(CopyLocal)' == 'true' "/>
    </ItemGroup>

    <!-- 
        this config directly references the GenerateLineMapTask.cs file
        the parms here are replicated as required parameters in that class
    -->
    <GenerateLineMapTask
      SolutionDir="$(SolutionDir)"
      SolutionPath="$(SolutionPath)"
      ProjectDir="$(ProjectDir)"
      ProjectFileName="$(ProjectFileName)"
      ProjectPath="$(ProjectPath)"
      TargetDir="$(TargetDir)"
      TargetPath="$(TargetPath)"
      TargetFileName="$(TargetFileName)"
      InputAssemblies="@(CopyLocalReferences)"
      TargetFrameworkVersion="$(TargetFrameworkVersion)"
      TargetArchitecture="$(Platform)"
      KeyFile="$(AssemblyOriginatorKeyFile)"
      ConfigurationFilePath="$(ProjectDir)GenerateLineMap_Config.json"
      />
  </Target>
</Project>
